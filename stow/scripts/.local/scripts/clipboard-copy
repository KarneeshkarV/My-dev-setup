#!/usr/bin/env bash
# clipboard-copy: OSC 52-based clipboard that works locally (Wayland/X11) AND over SSH
buf=$(cat)
b64=$(printf '%s' "$buf" | base64 | tr -d '\n')

# Try native clipboard if running locally with a display
if [ -n "$WAYLAND_DISPLAY" ] && command -v wl-copy >/dev/null 2>&1; then
    printf '%s' "$buf" | wl-copy --trim-newline 2>/dev/null &
elif [ -n "$DISPLAY" ] && command -v xclip >/dev/null 2>&1; then
    printf '%s' "$buf" | xclip -in -selection clipboard 2>/dev/null &
fi

# OSC 52: terminal-level clipboard, travels through SSH to Ghostty
if [ -n "$TMUX" ]; then
    # Wrap in tmux DCS passthrough so tmux forwards it to the outer terminal
    printf "\033Ptmux;\033\033]52;c;%s\007\033\\" "$b64"
else
    printf "\033]52;c;%s\007" "$b64"
fi
